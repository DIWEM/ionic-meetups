/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, ViewEncapsulation } from '@angular/core';
import * as Quagga from 'quagga';
import { mapToReader } from './barcode-types';
import { DEFAULT_CONFIG } from './barcode-scanner-livestream.config';
var BarecodeScannerLivestreamComponent = /** @class */ (function () {
    function BarecodeScannerLivestreamComponent() {
        // Outputs
        this.valueChanges = new EventEmitter();
        this.started = false;
        this.configQuagga = DEFAULT_CONFIG;
    }
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.stop();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        this.retart();
    };
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype._init = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            Quagga.onProcessed(function (result) { return _this.onProcessed(result); });
            Quagga.onDetected(function (result) { return _this.onDetected(result); });
            _this.configQuagga.inputStream.target = _this.barecodeScanner.nativeElement;
            if (_this.type) {
                _this.configQuagga.decoder.readers = mapToReader(_this.type);
            }
            Quagga.init(_this.configQuagga, function (err) {
                if (err) {
                    console.log(err);
                    return reject(err);
                }
                resolve();
            });
        });
    };
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.start = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.started) {
            return this._init().then(function () {
                Quagga.start();
                _this.started = true;
                console.log('started');
            });
        }
        return Promise.resolve();
    };
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.stop = /**
     * @return {?}
     */
    function () {
        if (this.started) {
            Quagga.stop();
            this.started = false;
            console.log('stopped');
        }
    };
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.retart = /**
     * @return {?}
     */
    function () {
        if (this.started) {
            this.stop();
            this.start();
        }
    };
    /**
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.isStarted = /**
     * @return {?}
     */
    function () {
        return this.started;
    };
    /**
     * @param {?} result
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.onProcessed = /**
     * @param {?} result
     * @return {?}
     */
    function (result) {
        /** @type {?} */
        var drawingCtx = Quagga.canvas.ctx.overlay;
        /** @type {?} */
        var drawingCanvas = Quagga.canvas.dom.overlay;
        if (result) {
            if (result.boxes) {
                drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute('width')), parseInt(drawingCanvas.getAttribute('height')));
                result.boxes.filter(function (box) {
                    return box !== result.box;
                }).forEach(function (box) {
                    Quagga.ImageDebug.drawPath(box, {
                        x: 0,
                        y: 1,
                    }, drawingCtx, {
                        color: 'green',
                        lineWidth: 2,
                    });
                });
            }
            if (result.box) {
                Quagga.ImageDebug.drawPath(result.box, {
                    x: 0,
                    y: 1,
                }, drawingCtx, {
                    color: '#00F',
                    lineWidth: 2,
                });
            }
            if (result.codeResult && result.codeResult.code) {
                Quagga.ImageDebug.drawPath(result.line, {
                    x: 'x',
                    y: 'y',
                }, drawingCtx, {
                    color: 'red',
                    lineWidth: 3,
                });
            }
        }
    };
    /**
     * @param {?} result
     * @return {?}
     */
    BarecodeScannerLivestreamComponent.prototype.onDetected = /**
     * @param {?} result
     * @return {?}
     */
    function (result) {
        this.valueChanges.next(result);
    };
    BarecodeScannerLivestreamComponent.decorators = [
        { type: Component, args: [{
                    selector: 'barcode-scanner-livestream',
                    template: "<div #BarecodeScanner class=\"scanner\" [hidden]=\"!isStarted()\">\n</div>",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".scanner{position:relative}.scanner canvas,.scanner video{max-width:100%;width:100%}.scanner canvas.drawingBuffer{position:absolute;left:0;top:0}"]
                }] }
    ];
    BarecodeScannerLivestreamComponent.propDecorators = {
        type: [{ type: Input }],
        valueChanges: [{ type: Output }],
        barecodeScanner: [{ type: ViewChild, args: ['BarecodeScanner',] }]
    };
    return BarecodeScannerLivestreamComponent;
}());
export { BarecodeScannerLivestreamComponent };
if (false) {
    /** @type {?} */
    BarecodeScannerLivestreamComponent.prototype.type;
    /** @type {?} */
    BarecodeScannerLivestreamComponent.prototype.valueChanges;
    /** @type {?} */
    BarecodeScannerLivestreamComponent.prototype.barecodeScanner;
    /** @type {?} */
    BarecodeScannerLivestreamComponent.prototype.started;
    /** @type {?} */
    BarecodeScannerLivestreamComponent.prototype.configQuagga;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFyY29kZS1zY2FubmVyLWxpdmVzdHJlYW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWJhcmNvZGUtc2Nhbm5lci8iLCJzb3VyY2VzIjpbImxpYi9iYXJjb2RlLXNjYW5uZXItbGl2ZXN0cmVhbS9iYXJjb2RlLXNjYW5uZXItbGl2ZXN0cmVhbS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFhLGlCQUFpQixFQUNsRixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEtBQUssTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUNqQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHFDQUFxQyxDQUFDOzs7O1FBYWpFLG9CQUF5QixJQUFJLFlBQVksRUFBRSxDQUFDO3VCQUkxQixLQUFLOzRCQUVBLGNBQWM7Ozs7O0lBRXJDLHdEQUFXOzs7SUFBWDtRQUNJLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztLQUNmOzs7OztJQUVELHdEQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtRQUM5QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7S0FDakI7Ozs7SUFFTyxrREFBSzs7Ozs7UUFDVCxPQUFPLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFDL0IsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFDLE1BQU0sSUFBSyxPQUFBLEtBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEVBQXhCLENBQXdCLENBQUMsQ0FBQztZQUV6RCxNQUFNLENBQUMsVUFBVSxDQUFDLFVBQUMsTUFBTSxJQUFLLE9BQUEsS0FBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBdkIsQ0FBdUIsQ0FBQyxDQUFDO1lBRXZELEtBQUksQ0FBQyxZQUFZLENB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QkFDSixDQUFDLEVBQUUsQ0FBQztpQkFDUCxFQUFFLFVBQVUsRUFBRTtvQkFDUCxLQUFLLEVBQUUsTUFBTTtvQkFDYixTQUFTLEVBQUUsQ0FBQztpQkFDZixDQUFDLENBQUM7YUFDVjtZQUVELElBQUksTUFBTSxDQUFDLFVBQVUsSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRTtnQkFDN0MsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRTtvQkFDcEMsQ0FBQyxFQUFFLEdBQUc7b0JBQ04sQ0FBQyxFQUFFLEdBQUc7aUJBQ1QsRUFBRSxVQUFVLEVBQUU7b0JBQ1AsS0FBSyxFQUFFLEtBQUs7b0JBQ1osU0FBUyxFQUFFLENBQUM7aUJBQ2YsQ0FBQyxDQUFDO2FBQ1Y7U0FFSjtLQUNKOzs7OztJQUVELHVEQUFVOzs7O0lBQVYsVUFBVyxNQUFNO1FBQ2IsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDbEM7O2dCQTlISixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLDRCQUE0QjtvQkFDdEMsc0ZBQTBEO29CQUUxRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7aUJBQ3hDOzs7dUJBR0ksS0FBSzsrQkFHTCxNQUFNO2tDQUVOLFNBQVMsU0FBQyxpQkFBaUI7OzZDQXBCaEM7O1NBYWEsa0NBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgVmlld0NoaWxkLCBPbkRlc3Ryb3ksIFZpZXdFbmNhcHN1bGF0aW9uLCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXNcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBRdWFnZ2EgZnJvbSAncXVhZ2dhJztcbmltcG9ydCB7IG1hcFRvUmVhZGVyIH0gZnJvbSAnLi9iYXJjb2RlLXR5cGVzJztcbmltcG9ydCB7IERFRkFVTFRfQ09ORklHIH0gZnJvbSAnLi9iYXJjb2RlLXNjYW5uZXItbGl2ZXN0cmVhbS5jb25maWcnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2JhcmNvZGUtc2Nhbm5lci1saXZlc3RyZWFtJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYmFyY29kZS1zY2FubmVyLWxpdmVzdHJlYW0uY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2JhcmNvZGUtc2Nhbm5lci1saXZlc3RyZWFtLmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbn0pXG5leHBvcnQgY2xhc3MgQmFyZWNvZGVTY2FubmVyTGl2ZXN0cmVhbUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgICAvLyBJbnB1dHNcbiAgICBASW5wdXQoKSB0eXBlOiBzdHJpbmc7XG5cbiAgICAvLyBPdXRwdXRzXG4gICAgQE91dHB1dCgpIHZhbHVlQ2hhbmdlcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblxuICAgIEBWaWV3Q2hpbGQoJ0JhcmVjb2RlU2Nhbm5lcicpIGJhcmVjb2RlU2Nhbm5lcjtcblxuICAgIHByaXZhdGUgc3RhcnRlZCA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBjb25maWdRdWFnZ2EgPSBERUZBVUxUX0NPTkZJRztcblxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnN0b3AoKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIHRoaXMucmV0YXJ0KCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfaW5pdCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIFF1YWdnYS5vblByb2Nlc3NlZCgocmVzdWx0KSA9PiB0aGlzLm9uUHJvY2Vzc2VkKHJlc3VsdCkpO1xuXG4gICAgICAgICAgICBRdWFnZ2Eub25EZXRlY3RlZCgocmVzdWx0KSA9PiB0aGlzLm9uRGV0ZWN0ZWQocmVzdWx0KSk7XG5cbiAgICAgICAgICAgIHRoaXMuY29uZmlnUXVhZ2dhLmlucHV0U3RyZWFtLnRhcmdldCA9IHRoaXMuYmFyZWNvZGVTY2FubmVyLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnR5cGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ1F1YWdnYS5kZWNvZGVyLnJlYWRlcnMgPSBtYXBUb1JlYWRlcih0aGlzLnR5cGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBRdWFnZ2EuaW5pdCh0aGlzLmNvbmZpZ1F1YWdnYSwgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbml0KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgUXVhZ2dhLnN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc3RhcnRlZCcpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cblxuICAgIHN0b3AoKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHtcbiAgICAgICAgICAgIFF1YWdnYS5zdG9wKCk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdG9wcGVkJylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldGFydCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhcnRlZCkge1xuICAgICAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpc1N0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXJ0ZWQ7XG4gICAgfVxuXG4gICAgb25Qcm9jZXNzZWQocmVzdWx0OiBhbnkpOiBhbnkge1xuICAgICAgICBsZXQgZHJhd2luZ0N0eCA9IFF1YWdnYS5jYW52YXMuY3R4Lm92ZXJsYXksXG4gICAgICAgICAgICBkcmF3aW5nQ2FudmFzID0gUXVhZ2dhLmNhbnZhcy5kb20ub3ZlcmxheTtcblxuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LmJveGVzKSB7XG4gICAgICAgICAgICAgICAgZHJhd2luZ0N0eC5jbGVhclJlY3QoMCwgMCwgcGFyc2VJbnQoZHJhd2luZ0NhbnZhcy5nZXRBdHRyaWJ1dGUoJ3dpZHRoJykpLCBwYXJzZUludChkcmF3aW5nQ2FudmFzLmdldEF0dHJpYnV0ZSgnaGVpZ2h0JykpKTtcbiAgICAgICAgICAgICAgICByZXN1bHQuYm94ZXMuZmlsdGVyKGZ1bmN0aW9uIChib3gpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJveCAhPT0gcmVzdWx0LmJveDtcbiAgICAgICAgICAgICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChib3gpIHtcbiAgICAgICAgICAgICAgICAgICAgUXVhZ2dhLkltYWdlRGVidWcuZHJhd1BhdGgoYm94LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMSxcbiAgICAgICAgICAgICAgICAgICAgfSwgZHJhd2luZ0N0eCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnZ3JlZW4nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0LmJveCkge1xuICAgICAgICAgICAgICAgIFF1YWdnYS5JbWFnZURlYnVnLmRyYXdQYXRoKHJlc3VsdC5ib3gsIHtcbiAgICAgICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICAgICAgeTogMSxcbiAgICAgICAgICAgICAgICB9LCBkcmF3aW5nQ3R4LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyMwMEYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoOiAyLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHJlc3VsdC5jb2RlUmVzdWx0ICYmIHJlc3VsdC5jb2RlUmVzdWx0LmNvZGUpIHtcbiAgICAgICAgICAgICAgICBRdWFnZ2EuSW1hZ2VEZWJ1Zy5kcmF3UGF0aChyZXN1bHQubGluZSwge1xuICAgICAgICAgICAgICAgICAgICB4OiAneCcsXG4gICAgICAgICAgICAgICAgICAgIHk6ICd5JyxcbiAgICAgICAgICAgICAgICB9LCBkcmF3aW5nQ3R4LCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ3JlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDMsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkRldGVjdGVkKHJlc3VsdCkge1xuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlcy5uZXh0KHJlc3VsdCk7XG4gICAgfVxuXG59XG5cbiJdfQ==